const { getMessage } = require('../lib/languages');

const fetch = require('node-fetch');
let handler = async (m, { conn, args, usedPrefix, command }) => {
    // Get user's preferred language
    const user = global.db.data.users[m.sender];
    const chat = global.db.data.chats[m.chat];
    const lang = user?.language || chat?.language || global.language;
 {
 if (!args[0]) throw `ðŸš© *Example:* ${usedPrefix + command} anime`
  try {
    const res = await fetch(`https://api.betabotz.eu.org/fire/search/tiktoks?query=${args[0]}&apikey=${lann}`);
    const fire = await res.json();
    const randomIndex = Math.floor(Math.random() * fire.result.data.length);
    let video = fire.result.data[randomIndex];
    let capt = `ä¹‚ *T I K T O K  S E A R C H*\n\n`;
    capt += `  â—¦ *video ${randomIndex + 1}*\n`;
    capt += `  â—¦ *video ID*: ${video.video_id}\n`;
    capt += `  â—¦ *Region*: ${video.region}\n`;
    capt += `  â—¦ *Title*: ${video.title}\n`;
    capt += `  â—¦ *Duration*: ${video.duration} seconds\n`;
    capt += `  â—¦ *Music Info:*\n`;
    capt += `  â—¦ *ID*: ${video.music_info.id}\n`;
    capt += `  â—¦ *Title*: ${video.music_info.title}\n`;
    capt += `  â—¦ *Author*: ${video.music_info.author}\n`;
    capt += `  â—¦ *Original*: ${video.music_info.original ? "Yes" : "No"}\n`;
    capt += `  â—¦ *Duration*: ${video.music_info.duration} seconds\n`;
    capt += `  â—¦ *Album*: ${video.music_info.album}\n`;
    capt += `  â—¦ *play Count*: ${video.play_count}\n`;
    capt += `  â—¦ *Digg Count*: ${video.digg_count}\n`;
    capt += `  â—¦ *Comment Count*: ${video.comment_count}\n`;
    capt += `  â—¦ *Share Count*: ${video.share_count}\n`;
    capt += `  â—¦ *Download Count*: ${video.download_count}\n`;
    capt += `  â—¦ *Created Time*: ${new Date(video.create_time * 1000).toUTCString()}\n`;
    capt += `  â—¦ *Is Ad*: ${video.is_ad ? "Yes" : "No"}\n`;
    capt += `  â—¦ *Is Top*: ${video.is_top ? "Yes" : "No"}\n`;
    capt += `  â—¦ *Author:*\n`;
    capt += `  â—¦ *ID*: ${video.author.id}\n`;
    capt += `  â—¦ *Unique ID*: ${video.author.unique_id}\n`;
    capt += `  â—¦ *Nickname*: ${video.author.nickname}\n`;
    capt += `\n`;
    conn.sendFile(m.chat, video.play, null, capt, m);
  } catch (error) {
    throw `ðŸš© *video Not found!*`
  }
}
handler.help = ['ttsearch'].map(v => v + ' <username>');
handler.tags = ['internet'];
handler.command = /^(tiktoksearch|ttsearch)$/i;
handler.limit = true;

}

module.exports = handler;
